<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘é¡µæ€§èƒ½æµ‹è¯•å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #007bff;
        }
        
        .test-section h2 {
            color: #495057;
            margin-bottom: 15px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
        }
        
        .metric-label {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s;
        }
        
        .results-area {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .status-good { color: #28a745; }
        .status-warning { color: #ffc107; }
        .status-error { color: #dc3545; }
        
        .lighthouse-score {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 20px 0;
        }
        
        .score-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        
        .score-90 { background: #0cce6b; }
        .score-70 { background: #ffa500; }
        .score-50 { background: #ff5722; }
        
        .url-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        .comparison-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        
        .improvement {
            color: #28a745;
            font-weight: bold;
        }
        
        .degradation {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ç½‘é¡µæ€§èƒ½æµ‹è¯•å·¥å…·</h1>
        
        <!-- åŸºæœ¬æ€§èƒ½æŒ‡æ ‡ -->
        <div class="test-section">
            <h2>ğŸ“Š åŸºæœ¬æ€§èƒ½æŒ‡æ ‡</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="load-time">--</div>
                    <div class="metric-label">é¡µé¢åŠ è½½æ—¶é—´ (ç§’)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="dom-ready">--</div>
                    <div class="metric-label">DOMå‡†å¤‡æ—¶é—´ (æ¯«ç§’)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="first-paint">--</div>
                    <div class="metric-label">é¦–æ¬¡æ¸²æŸ“ (æ¯«ç§’)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="largest-paint">--</div>
                    <div class="metric-label">æœ€å¤§å†…å®¹æ¸²æŸ“ (æ¯«ç§’)</div>
                </div>
            </div>
            <button class="test-button" onclick="measureBasicMetrics()">æµ‹é‡åŸºæœ¬æŒ‡æ ‡</button>
        </div>
        
        <!-- ç½‘ç»œæ€§èƒ½æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸŒ ç½‘ç»œæ€§èƒ½æµ‹è¯•</h2>
            <input type="url" class="url-input" id="test-url" placeholder="è¾“å…¥è¦æµ‹è¯•çš„ç½‘é¡µURL (é»˜è®¤æµ‹è¯•å½“å‰é¡µé¢)" />
            <div class="progress-bar">
                <div class="progress-fill" id="network-progress"></div>
            </div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="network-latency">--</div>
                    <div class="metric-label">ç½‘ç»œå»¶è¿Ÿ (æ¯«ç§’)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="download-speed">--</div>
                    <div class="metric-label">ä¸‹è½½é€Ÿåº¦ (KB/s)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="resource-count">--</div>
                    <div class="metric-label">èµ„æºæ•°é‡</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="total-size">--</div>
                    <div class="metric-label">æ€»å¤§å° (KB)</div>
                </div>
            </div>
            <button class="test-button" onclick="testNetworkPerformance()">å¼€å§‹ç½‘ç»œæµ‹è¯•</button>
        </div>
        
        <!-- Lighthouseé£æ ¼è¯„åˆ† -->
        <div class="test-section">
            <h2>ğŸ’¡ æ€§èƒ½è¯„åˆ†</h2>
            <div class="lighthouse-score">
                <div>
                    <div class="score-circle score-90" id="performance-score">--</div>
                    <div style="text-align: center; margin-top: 10px;">æ€§èƒ½</div>
                </div>
                <div>
                    <div class="score-circle score-70" id="accessibility-score">--</div>
                    <div style="text-align: center; margin-top: 10px;">å¯è®¿é—®æ€§</div>
                </div>
                <div>
                    <div class="score-circle score-90" id="best-practices-score">--</div>
                    <div style="text-align: center; margin-top: 10px;">æœ€ä½³å®è·µ</div>
                </div>
                <div>
                    <div class="score-circle score-90" id="seo-score">--</div>
                    <div style="text-align: center; margin-top: 10px;">SEO</div>
                </div>
            </div>
            <button class="test-button" onclick="calculateScores()">è®¡ç®—è¯„åˆ†</button>
        </div>
        
        <!-- ä¼˜åŒ–å»ºè®® -->
        <div class="test-section">
            <h2>ğŸ”§ ä¼˜åŒ–å»ºè®®</h2>
            <div class="results-area" id="optimization-suggestions">
                ç‚¹å‡»"ç”Ÿæˆä¼˜åŒ–å»ºè®®"æŒ‰é’®æ¥è·å–é’ˆå¯¹æ€§çš„ä¼˜åŒ–å»ºè®®...
            </div>
            <button class="test-button" onclick="generateOptimizationSuggestions()">ç”Ÿæˆä¼˜åŒ–å»ºè®®</button>
        </div>
        
        <!-- æ¯”è¾ƒæŠ¥å‘Š -->
        <div class="test-section">
            <h2>ğŸ“ˆ æ€§èƒ½æ¯”è¾ƒ</h2>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>æŒ‡æ ‡</th>
                        <th>ä¼˜åŒ–å‰</th>
                        <th>ä¼˜åŒ–å</th>
                        <th>æ”¹è¿›</th>
                    </tr>
                </thead>
                <tbody id="comparison-body">
                    <tr>
                        <td colspan="4" style="text-align: center; color: #6c757d;">
                            è¿è¡Œæµ‹è¯•åå°†æ˜¾ç¤ºæ¯”è¾ƒæ•°æ®
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- è¯¦ç»†æŠ¥å‘Š -->
        <div class="test-section">
            <h2>ğŸ“‹ è¯¦ç»†æŠ¥å‘Š</h2>
            <div class="results-area" id="detailed-report">
                æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...
            </div>
            <button class="test-button" onclick="generateDetailedReport()">ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š</button>
            <button class="test-button" onclick="exportReport()">å¯¼å‡ºæŠ¥å‘Š</button>
        </div>
    </div>

    <script>
        class PerformanceTester {
            constructor() {
                this.testResults = {
                    basic: {},
                    network: {},
                    scores: {},
                    history: []
                };
                this.isTestingNetwork = false;
            }

            // æµ‹é‡åŸºæœ¬æ€§èƒ½æŒ‡æ ‡
            async measureBasicMetrics() {
                console.log('ğŸ” å¼€å§‹æµ‹é‡åŸºæœ¬æ€§èƒ½æŒ‡æ ‡...');
                
                try {
                    // é¡µé¢åŠ è½½æ—¶é—´
                    const loadTime = (performance.timing.loadEventEnd - performance.timing.navigationStart) / 1000;
                    document.getElementById('load-time').textContent = loadTime.toFixed(2);
                    
                    // DOMå‡†å¤‡æ—¶é—´
                    const domReady = performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart;
                    document.getElementById('dom-ready').textContent = domReady.toFixed(0);
                    
                    // è·å–Paint Timing
                    const paintEntries = performance.getEntriesByType('paint');
                    const firstPaint = paintEntries.find(entry => entry.name === 'first-paint');
                    const firstContentfulPaint = paintEntries.find(entry => entry.name === 'first-contentful-paint');
                    
                    if (firstPaint) {
                        document.getElementById('first-paint').textContent = firstPaint.startTime.toFixed(0);
                    }
                    
                    // è·å–Largest Contentful Paint
                    if (window.PerformanceObserver) {
                        this.observeLCP();
                    }
                    
                    this.testResults.basic = {
                        loadTime: loadTime,
                        domReady: domReady,
                        firstPaint: firstPaint?.startTime || 0,
                        timestamp: new Date()
                    };
                    
                    this.appendToReport('âœ… åŸºæœ¬æ€§èƒ½æŒ‡æ ‡æµ‹é‡å®Œæˆ');
                    
                } catch (error) {
                    console.error('æµ‹é‡åŸºæœ¬æŒ‡æ ‡æ—¶å‡ºé”™:', error);
                    this.appendToReport('âŒ åŸºæœ¬æŒ‡æ ‡æµ‹é‡å¤±è´¥: ' + error.message);
                }
            }

            // è§‚å¯Ÿæœ€å¤§å†…å®¹æ¸²æŸ“
            observeLCP() {
                if (!window.PerformanceObserver) return;
                
                try {
                    const po = new PerformanceObserver((entryList) => {
                        const entries = entryList.getEntries();
                        const lastEntry = entries[entries.length - 1];
                        if (lastEntry) {
                            document.getElementById('largest-paint').textContent = lastEntry.startTime.toFixed(0);
                        }
                    });
                    
                    po.observe({entryTypes: ['largest-contentful-paint']});
                } catch (error) {
                    console.warn('LCPè§‚å¯Ÿå¤±è´¥:', error);
                }
            }

            // æµ‹è¯•ç½‘ç»œæ€§èƒ½
            async testNetworkPerformance() {
                if (this.isTestingNetwork) return;
                
                this.isTestingNetwork = true;
                const button = event.target;
                button.disabled = true;
                button.textContent = 'æµ‹è¯•ä¸­...';
                
                try {
                    console.log('ğŸŒ å¼€å§‹ç½‘ç»œæ€§èƒ½æµ‹è¯•...');
                    
                    // é‡ç½®è¿›åº¦æ¡
                    this.updateProgress(0);
                    
                    // æµ‹è¯•ç½‘ç»œå»¶è¿Ÿ
                    await this.measureNetworkLatency();
                    this.updateProgress(25);
                    
                    // æµ‹è¯•ä¸‹è½½é€Ÿåº¦
                    await this.measureDownloadSpeed();
                    this.updateProgress(50);
                    
                    // åˆ†æèµ„æº
                    this.analyzeResources();
                    this.updateProgress(75);
                    
                    // æµ‹è¯•DNSè§£æ
                    await this.testDNSResolution();
                    this.updateProgress(100);
                    
                    this.appendToReport('âœ… ç½‘ç»œæ€§èƒ½æµ‹è¯•å®Œæˆ');
                    
                } catch (error) {
                    console.error('ç½‘ç»œæµ‹è¯•å¤±è´¥:', error);
                    this.appendToReport('âŒ ç½‘ç»œæµ‹è¯•å¤±è´¥: ' + error.message);
                } finally {
                    this.isTestingNetwork = false;
                    button.disabled = false;
                    button.textContent = 'å¼€å§‹ç½‘ç»œæµ‹è¯•';
                }
            }

            // æµ‹é‡ç½‘ç»œå»¶è¿Ÿ
            async measureNetworkLatency() {
                const testUrl = document.getElementById('test-url').value || window.location.href;
                const startTime = performance.now();
                
                try {
                    const response = await fetch(testUrl, {
                        method: 'HEAD',
                        mode: 'no-cors',
                        cache: 'no-cache'
                    });
                    
                    const endTime = performance.now();
                    const latency = endTime - startTime;
                    
                    document.getElementById('network-latency').textContent = latency.toFixed(0);
                    this.testResults.network.latency = latency;
                    
                } catch (error) {
                    document.getElementById('network-latency').textContent = 'N/A';
                    console.warn('å»¶è¿Ÿæµ‹è¯•å¤±è´¥:', error);
                }
            }

            // æµ‹é‡ä¸‹è½½é€Ÿåº¦
            async measureDownloadSpeed() {
                try {
                    const testImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==';
                    const startTime = performance.now();
                    
                    const response = await fetch(testImage);
                    const blob = await response.blob();
                    
                    const endTime = performance.now();
                    const duration = (endTime - startTime) / 1000; // è½¬æ¢ä¸ºç§’
                    const size = blob.size / 1024; // è½¬æ¢ä¸ºKB
                    const speed = size / duration;
                    
                    document.getElementById('download-speed').textContent = speed.toFixed(2);
                    this.testResults.network.downloadSpeed = speed;
                    
                } catch (error) {
                    document.getElementById('download-speed').textContent = 'N/A';
                    console.warn('ä¸‹è½½é€Ÿåº¦æµ‹è¯•å¤±è´¥:', error);
                }
            }

            // åˆ†æé¡µé¢èµ„æº
            analyzeResources() {
                try {
                    const resources = performance.getEntriesByType('resource');
                    const resourceCount = resources.length;
                    const totalSize = resources.reduce((total, resource) => {
                        return total + (resource.transferSize || 0);
                    }, 0) / 1024; // è½¬æ¢ä¸ºKB
                    
                    document.getElementById('resource-count').textContent = resourceCount;
                    document.getElementById('total-size').textContent = totalSize.toFixed(2);
                    
                    this.testResults.network.resourceCount = resourceCount;
                    this.testResults.network.totalSize = totalSize;
                    
                } catch (error) {
                    console.warn('èµ„æºåˆ†æå¤±è´¥:', error);
                }
            }

            // æµ‹è¯•DNSè§£æ
            async testDNSResolution() {
                try {
                    const navigation = performance.getEntriesByType('navigation')[0];
                    if (navigation) {
                        const dnsTime = navigation.domainLookupEnd - navigation.domainLookupStart;
                        this.testResults.network.dnsTime = dnsTime;
                        this.appendToReport(`DNSè§£ææ—¶é—´: ${dnsTime.toFixed(2)}ms`);
                    }
                } catch (error) {
                    console.warn('DNSæµ‹è¯•å¤±è´¥:', error);
                }
            }

            // æ›´æ–°è¿›åº¦æ¡
            updateProgress(percentage) {
                const progressBar = document.getElementById('network-progress');
                progressBar.style.width = percentage + '%';
            }

            // è®¡ç®—æ€§èƒ½è¯„åˆ†
            calculateScores() {
                console.log('ğŸ’¡ è®¡ç®—æ€§èƒ½è¯„åˆ†...');
                
                try {
                    // åŸºäºå®é™…æŒ‡æ ‡è®¡ç®—è¯„åˆ†
                    const loadTime = this.testResults.basic.loadTime || 3;
                    const resourceCount = this.testResults.network.resourceCount || 50;
                    const totalSize = this.testResults.network.totalSize || 1000;
                    
                    // æ€§èƒ½è¯„åˆ† (åŸºäºåŠ è½½æ—¶é—´)
                    let performanceScore = Math.max(0, Math.min(100, 100 - (loadTime - 1) * 20));
                    
                    // å¯è®¿é—®æ€§è¯„åˆ† (åŸºäºé¡µé¢ç»“æ„)
                    let accessibilityScore = this.calculateAccessibilityScore();
                    
                    // æœ€ä½³å®è·µè¯„åˆ† (åŸºäºç°ä»£Webæ ‡å‡†)
                    let bestPracticesScore = this.calculateBestPracticesScore();
                    
                    // SEOè¯„åˆ† (åŸºäºé¡µé¢SEOå…ƒç´ )
                    let seoScore = this.calculateSEOScore();
                    
                    // æ›´æ–°ç•Œé¢
                    this.updateScoreDisplay('performance-score', performanceScore);
                    this.updateScoreDisplay('accessibility-score', accessibilityScore);
                    this.updateScoreDisplay('best-practices-score', bestPracticesScore);
                    this.updateScoreDisplay('seo-score', seoScore);
                    
                    this.testResults.scores = {
                        performance: performanceScore,
                        accessibility: accessibilityScore,
                        bestPractices: bestPracticesScore,
                        seo: seoScore
                    };
                    
                    this.appendToReport('âœ… æ€§èƒ½è¯„åˆ†è®¡ç®—å®Œæˆ');
                    
                } catch (error) {
                    console.error('è¯„åˆ†è®¡ç®—å¤±è´¥:', error);
                    this.appendToReport('âŒ è¯„åˆ†è®¡ç®—å¤±è´¥: ' + error.message);
                }
            }

            // è®¡ç®—å¯è®¿é—®æ€§è¯„åˆ†
            calculateAccessibilityScore() {
                let score = 70; // åŸºç¡€åˆ†
                
                // æ£€æŸ¥altå±æ€§
                const images = document.querySelectorAll('img');
                const imagesWithAlt = document.querySelectorAll('img[alt]');
                if (images.length > 0) {
                    score += (imagesWithAlt.length / images.length) * 15;
                }
                
                // æ£€æŸ¥æ ‡é¢˜å±‚æ¬¡
                const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
                if (headings.length > 0) score += 10;
                
                // æ£€æŸ¥è¯­è¨€å±æ€§
                if (document.documentElement.lang) score += 5;
                
                return Math.min(100, Math.round(score));
            }

            // è®¡ç®—æœ€ä½³å®è·µè¯„åˆ†
            calculateBestPracticesScore() {
                let score = 80; // åŸºç¡€åˆ†
                
                // æ£€æŸ¥HTTPS
                if (location.protocol === 'https:') score += 10;
                
                // æ£€æŸ¥viewport metaæ ‡ç­¾
                if (document.querySelector('meta[name="viewport"]')) score += 5;
                
                // æ£€æŸ¥charset
                if (document.querySelector('meta[charset]')) score += 5;
                
                return Math.min(100, Math.round(score));
            }

            // è®¡ç®—SEOè¯„åˆ†
            calculateSEOScore() {
                let score = 70; // åŸºç¡€åˆ†
                
                // æ£€æŸ¥titleæ ‡ç­¾
                if (document.title && document.title.length > 10) score += 10;
                
                // æ£€æŸ¥meta description
                if (document.querySelector('meta[name="description"]')) score += 10;
                
                // æ£€æŸ¥h1æ ‡ç­¾
                if (document.querySelector('h1')) score += 5;
                
                // æ£€æŸ¥ç»“æ„åŒ–æ•°æ®
                if (document.querySelector('script[type="application/ld+json"]')) score += 5;
                
                return Math.min(100, Math.round(score));
            }

            // æ›´æ–°è¯„åˆ†æ˜¾ç¤º
            updateScoreDisplay(elementId, score) {
                const element = document.getElementById(elementId);
                element.textContent = Math.round(score);
                
                // æ›´æ–°é¢œè‰²
                element.className = 'score-circle';
                if (score >= 90) {
                    element.classList.add('score-90');
                } else if (score >= 70) {
                    element.classList.add('score-70');
                } else {
                    element.classList.add('score-50');
                }
            }

            // ç”Ÿæˆä¼˜åŒ–å»ºè®®
            generateOptimizationSuggestions() {
                console.log('ğŸ”§ ç”Ÿæˆä¼˜åŒ–å»ºè®®...');
                
                const suggestions = [];
                const loadTime = this.testResults.basic.loadTime || 0;
                const resourceCount = this.testResults.network.resourceCount || 0;
                const totalSize = this.testResults.network.totalSize || 0;
                
                // åŸºäºåŠ è½½æ—¶é—´çš„å»ºè®®
                if (loadTime > 3) {
                    suggestions.push('ğŸš€ é¡µé¢åŠ è½½æ—¶é—´è¾ƒæ…¢ï¼Œå»ºè®®ä¼˜åŒ–å›¾ç‰‡å‹ç¼©å’Œå¯ç”¨æµè§ˆå™¨ç¼“å­˜');
                }
                
                // åŸºäºèµ„æºæ•°é‡çš„å»ºè®®
                if (resourceCount > 100) {
                    suggestions.push('ğŸ“¦ èµ„æºæ–‡ä»¶è¾ƒå¤šï¼Œå»ºè®®åˆå¹¶CSS/JSæ–‡ä»¶æˆ–ä½¿ç”¨HTTP/2');
                }
                
                // åŸºäºæ–‡ä»¶å¤§å°çš„å»ºè®®
                if (totalSize > 2000) {
                    suggestions.push('ğŸ“ é¡µé¢æ€»å¤§å°è¾ƒå¤§ï¼Œå»ºè®®å¯ç”¨Gzipå‹ç¼©å’Œå»¶è¿ŸåŠ è½½');
                }
                
                // æ£€æŸ¥å…·ä½“ä¼˜åŒ–é¡¹
                if (!document.querySelector('link[rel="preload"]')) {
                    suggestions.push('âš¡ æ·»åŠ å…³é”®èµ„æºé¢„åŠ è½½ (preload) å¯æå‡æ€§èƒ½');
                }
                
                if (!document.querySelector('meta[name="viewport"]')) {
                    suggestions.push('ğŸ“± æ·»åŠ viewport metaæ ‡ç­¾ä»¥ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ');
                }
                
                // Webå­—ä½“ä¼˜åŒ–
                const googleFonts = document.querySelectorAll('link[href*="fonts.googleapis.com"]');
                if (googleFonts.length > 0) {
                    suggestions.push('ğŸ”¤ ä¸ºGoogleå­—ä½“æ·»åŠ display=swapå‚æ•°ä»¥é¿å…æ–‡å­—é—ªçƒ');
                }
                
                // å›¾ç‰‡ä¼˜åŒ–
                const images = document.querySelectorAll('img:not([loading="lazy"])');
                if (images.length > 5) {
                    suggestions.push('ğŸ–¼ï¸ ä¸ºå›¾ç‰‡æ·»åŠ æ‡’åŠ è½½ (loading="lazy") ä»¥æå‡åˆå§‹åŠ è½½é€Ÿåº¦');
                }
                
                // Service Workeræ£€æŸ¥
                if (!('serviceWorker' in navigator) || !navigator.serviceWorker.controller) {
                    suggestions.push('ğŸ’¾ å®æ–½Service Workerç¼“å­˜ç­–ç•¥ä»¥æå‡é‡å¤è®¿é—®æ€§èƒ½');
                }
                
                const suggestionsHTML = suggestions.length > 0 
                    ? suggestions.map(s => `<div style="margin: 10px 0; padding: 10px; background: #e8f4fd; border-left: 3px solid #007bff; border-radius: 4px;">${s}</div>`).join('')
                    : '<div style="color: #28a745; text-align: center; padding: 20px;">ğŸ‰ æ­å–œï¼æ‚¨çš„ç½‘é¡µæ€§èƒ½è¡¨ç°è‰¯å¥½ï¼Œæš‚æ— é‡è¦ä¼˜åŒ–å»ºè®®ã€‚</div>';
                
                document.getElementById('optimization-suggestions').innerHTML = suggestionsHTML;
                this.appendToReport('âœ… ä¼˜åŒ–å»ºè®®ç”Ÿæˆå®Œæˆ');
            }

            // ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
            generateDetailedReport() {
                console.log('ğŸ“‹ ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š...');
                
                const report = `
=== ç½‘é¡µæ€§èƒ½è¯¦ç»†æŠ¥å‘Š ===
ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}
æµ‹è¯•é¡µé¢: ${window.location.href}

ğŸ“Š åŸºæœ¬æ€§èƒ½æŒ‡æ ‡:
- é¡µé¢åŠ è½½æ—¶é—´: ${this.testResults.basic.loadTime || 'N/A'}ç§’
- DOMå‡†å¤‡æ—¶é—´: ${this.testResults.basic.domReady || 'N/A'}æ¯«ç§’
- é¦–æ¬¡æ¸²æŸ“æ—¶é—´: ${this.testResults.basic.firstPaint || 'N/A'}æ¯«ç§’

ğŸŒ ç½‘ç»œæ€§èƒ½:
- ç½‘ç»œå»¶è¿Ÿ: ${this.testResults.network.latency || 'N/A'}æ¯«ç§’
- ä¸‹è½½é€Ÿåº¦: ${this.testResults.network.downloadSpeed || 'N/A'}KB/s
- èµ„æºæ–‡ä»¶æ•°é‡: ${this.testResults.network.resourceCount || 'N/A'}ä¸ª
- é¡µé¢æ€»å¤§å°: ${this.testResults.network.totalSize || 'N/A'}KB
- DNSè§£ææ—¶é—´: ${this.testResults.network.dnsTime || 'N/A'}æ¯«ç§’

ğŸ’¡ æ€§èƒ½è¯„åˆ†:
- æ€§èƒ½è¯„åˆ†: ${this.testResults.scores.performance || 'N/A'}/100
- å¯è®¿é—®æ€§: ${this.testResults.scores.accessibility || 'N/A'}/100
- æœ€ä½³å®è·µ: ${this.testResults.scores.bestPractices || 'N/A'}/100
- SEOè¯„åˆ†: ${this.testResults.scores.seo || 'N/A'}/100

ğŸ”§ æµè§ˆå™¨ä¿¡æ¯:
- ç”¨æˆ·ä»£ç†: ${navigator.userAgent}
- è§†çª—å¤§å°: ${window.innerWidth}x${window.innerHeight}
- è¿æ¥ç±»å‹: ${navigator.connection?.effectiveType || 'Unknown'}

ğŸ“ˆ æ€§èƒ½å»ºè®®:
${document.getElementById('optimization-suggestions').textContent || 'è¯·å…ˆç”Ÿæˆä¼˜åŒ–å»ºè®®'}

=== æŠ¥å‘Šç»“æŸ ===
                `.trim();
                
                document.getElementById('detailed-report').textContent = report;
                this.appendToReport('âœ… è¯¦ç»†æŠ¥å‘Šç”Ÿæˆå®Œæˆ');
            }

            // å¯¼å‡ºæŠ¥å‘Š
            exportReport() {
                const reportContent = document.getElementById('detailed-report').textContent;
                const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `æ€§èƒ½æµ‹è¯•æŠ¥å‘Š_${new Date().toISOString().slice(0, 10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.appendToReport('âœ… æŠ¥å‘Šå·²å¯¼å‡º');
            }

            // æ·»åŠ åˆ°è¯¦ç»†æŠ¥å‘Š
            appendToReport(message) {
                const timestamp = new Date().toLocaleTimeString();
                const reportArea = document.getElementById('detailed-report');
                reportArea.textContent += `[${timestamp}] ${message}\n`;
                reportArea.scrollTop = reportArea.scrollHeight;
            }
        }

        // åˆå§‹åŒ–æ€§èƒ½æµ‹è¯•å™¨
        const tester = new PerformanceTester();

        // ç»‘å®šå…¨å±€å‡½æ•°
        window.measureBasicMetrics = () => tester.measureBasicMetrics();
        window.testNetworkPerformance = () => tester.testNetworkPerformance();
        window.calculateScores = () => tester.calculateScores();
        window.generateOptimizationSuggestions = () => tester.generateOptimizationSuggestions();
        window.generateDetailedReport = () => tester.generateDetailedReport();
        window.exportReport = () => tester.exportReport();

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºæœ¬æµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(() => {
                tester.measureBasicMetrics();
                tester.calculateScores();
            }, 1000);
        });
    </script>
</body>
</html>
